@page "/CheckHuman"
@using ParaglidingFlightLogWeb.Services
@inject ICaptchaManager CaptchaManager
@inject NotificationService NotificationService
@inject NavigationManager NavigationManager

@rendermode InteractiveServer

<FriendlyCaptcha @ref="_friendlyCaptcha" />

<RadzenButton Text="Check" Click="@Check" />

@code {
    private FriendlyCaptcha? _friendlyCaptcha;
    [SupplyParameterFromQuery]
    [Parameter] public string? TargetPage { get; set; }
    //todo: call that only when captcha is solved, no user interaction needed
    private async Task Check()
    {
        if (_friendlyCaptcha is null) { return; }
        string token = await _friendlyCaptcha.Check();
        // Captcha solved successfully, navigate to the target page
        string finalTargetPage;

        if (string.IsNullOrEmpty(TargetPage))
        {
            finalTargetPage = "/";            
        }
        else
        {
            finalTargetPage = $"{TargetPage}?captchaToken={token}";
        }
        NavigationManager.NavigateTo(finalTargetPage);
    }
}
