@page "/FlightsStatistic"
@using System
@using System.IO
@using Microsoft.AspNetCore.Hosting
@using Microsoft.Extensions.Logging
@using ParaglidingFlightLogWeb.Components.Pages
@using ParaglidingFlightLogWeb.ViewModels
@using ParaglidingFlightLogWeb.Components.Subs

@rendermode InteractiveServer

<PageTitle>Flights statistic</PageTitle>


<RadzenRow>
    <RadzenColumn Size="12">
        <RadzenFormField Text="Analyze" Variant="@variant">
            <RadzenDropDown TValue="StatisticalFlightsAnalysis" AllowFiltering="false" Data=@Enum.GetValues(typeof(StatisticalFlightsAnalysis)) @bind-Value=AnalysisToDo
                            Class="w-100">
                <Template>
                    @(GetAnalyseName(context))
                </Template>
            </RadzenDropDown>
        </RadzenFormField>
        <RadzenFormField Text="Year to analyze" Variant="@variant">
            <RadzenDropDown AllowFiltering="false" Data=@mvm.YearsOfFlying @bind-Value=@YearToAnalyse
                            Class="w-100" />
        </RadzenFormField>
        <RadzenButton Click=@(args => OnAnalyze()) Text="Analyze" ButtonStyle="ButtonStyle.Primary" />
    </RadzenColumn>



    <MyNumericIndicator Label="Flight Count" Value="@fsvm.FlightsCount" Format="F0" />
    <MyTextIndicator Label="Flights total duration" Text="@fsvm.FlightsDurationText" />

    <MyTextIndicator Label="Flights mean duration" Text="@fsvm.MeanFlightsDurationText" />
    <MyTextIndicator Label="Flights median duration" Text="@fsvm.MedianFlightDurationText" />

</RadzenRow>
<RadzenRow>
    <RadzenColumn>
        <RadzenChart style="height: 700px">
            <RadzenLegend Position="LegendPosition.Top" />


            @if (AnalysisToDo == StatisticalFlightsAnalysis.DurationDistribution)
            {
                <RadzenValueAxis FormatString="{0:N2}">
                    <RadzenAxisTitle Text="Number of Flight" />
                </RadzenValueAxis>
                <RadzenCategoryAxis>
                    <RadzenAxisTitle Text="Flight Duration in Hours"/>
                </RadzenCategoryAxis>
                <RadzenColumnSeries Data="@DurationAnalysisResult"
                                    Title="Flight duration repartition"
                                    CategoryProperty="BarLocation"
                                    ValueProperty="BarValue" />
            }
            @if (AnalysisToDo == StatisticalFlightsAnalysis.MontlyMedian)
            {
                <RadzenValueAxis FormatString="{0:N2}">
                    <RadzenAxisTitle Text="Median in Hours" />
                </RadzenValueAxis>
                int i = 0;
                foreach (YearMonthlyStatistic item in MonthlyMedianAnalysisResult)
                {
                    <RadzenColumnSeries Data="@item.MonthlyMedianItems"
                                        Title="@mvm.YearsOfFlying[i].ToString()"
                                        CategoryProperty="Month"
                                        ValueProperty="BarValue" />
                    i++;
                }
            }
            @if (AnalysisToDo == StatisticalFlightsAnalysis.MonthlyFlightDuration)
            {
                <RadzenValueAxis FormatString="{0:N2}">
                    <RadzenAxisTitle Text="Flight Hours" />
                </RadzenValueAxis>
                int i = 0;
                foreach (YearMonthlyStatistic item in MonthlyDurationAnalysisResult)
                {
                    <RadzenColumnSeries Data="@item.MonthlyMedianItems"
                                        Title="@mvm.YearsOfFlying[i].ToString()"
                                        CategoryProperty="Month"
                                        ValueProperty="BarValue" />
                    i++;
                }
            }
        </RadzenChart>
    </RadzenColumn>

</RadzenRow>



